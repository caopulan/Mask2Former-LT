# Prepare Datasets for LTSS

A dataset can be used by accessing [DatasetCatalog](https://detectron2.readthedocs.io/modules/data.html#detectron2.data.DatasetCatalog)
for its data, or [MetadataCatalog](https://detectron2.readthedocs.io/modules/data.html#detectron2.data.MetadataCatalog) for its metadata (class names, etc).
This document explains how to setup the builtin datasets so they can be used by the above APIs.
[Use Custom Datasets](https://detectron2.readthedocs.io/tutorials/datasets.html) gives a deeper dive on how to use `DatasetCatalog` and `MetadataCatalog`,
and how to add new datasets to them.

MaskFormer has builtin support for a few datasets.
The datasets are assumed to exist in a directory specified by the environment variable
`DETECTRON2_DATASETS`.
Under this directory, detectron2 will look for datasets in the structure described below, if needed.
```
$DETECTRON2_DATASETS/
  ADEChallengeData2016/
  ADE20K_2021_17_01/
  coco_stuff_118k/
  coco_stuff_lt_40k/
  mhpv2_15k/
  mhpv2_lt_7k/
```

You can set the location for builtin datasets by `export DETECTRON2_DATASETS=/path/to/datasets`.
If left unset, the default is `./datasets` relative to your current working directory.


## Expected dataset structure for [ADE20K](http://sceneparsing.csail.mit.edu/):
```
ADEChallengeData2016/
  images/
  annotations_detectron2/   # generated by prepare_ade20k_sem_seg.py
  annotations/
  objectInfo150.txt
```

## Expected dataset structure for [ADE20K-Full](http://sceneparsing.csail.mit.edu/):
```
ADE20K_2021_17_01/
  images/
  images_detectron2/   # generated by prepare_ade20k_full_sem_seg.py
  annotations_detectron2/   # generated by prepare_ade20k_full_sem_seg.py
  index_ade20k.pkl
  ade20k-full-names.txt
```


## Expected dataset structure for [COCO-Stuff-118K](https://github.com/nightrome/cocostuff):

```
coco_stuff_118k/
  stuffthingmaps_trainval2017/
    # original annotations, download from http://calvin.inf.ed.ac.uk/wp-content/uploads/data/cocostuffdataset/stuffthingmaps_trainval2017.zip
    train2017/
    val2017/
  images/
    # image files, download from https://cocodataset.org/#download
    train2017/
    val2017/
  annotations/
    # annotation files, generated by prepare_coco_stuff_118k_sem_seg.py
    train2017/
    val2017/
  coco-stuff-names.txt
```


## Expected dataset structure for COCO-Stuff-LT-40K:

```
coco_stuff_lt_40k/
  coco-stuff-lt.txt  # download from out project
  images/
    train2017/  # generated by prepare_coco_stuff_lt_40k_sem_seg.py
    val2017/    # linked from coco_stuff_118k/images/val2017
  annotations/
    train2017/  # generated by prepare_coco_stuff_lt_40k_sem_seg.py
    val2017/    # linked from coco_stuff_118k/annotations/val2017
```


## Expected dataset structure for [MHPv2-15K](https://lv-mhp.github.io/dataset):

```
mhpv2_15k/
  LV-MHP-v2/    # original annotations, download from https://lv-mhp.github.io/dataset
    annotations/
    train_img/
    val_img/
    test_img/
    train_seg/
    val_seg/
    train_parsing/
    val_parsing/
  # run prepare_mhpv2_15k_sem_seg.py to fix truncated images.
  images/
    train/  # linked from mhpv2_15k/LV-MHP-v2/train_img
    val/    # linked from mhpv2_15k/LV-MHP-v2/val_img
  annotations/
    train/  # linked from mhpv2_15k/LV-MHP-v2/train_seg
    val/    # linked from mhpv2_15k/LV-MHP-v2/val_seg
```


## Expected dataset structure for MHPv2-LT-7K:

```
mhpv2_15k/
  mhpv2-lt.txt
  images/
    train/  # generated by prepare_mhpv2_lt_7k_sem_seg.py
    val/    # linked from mhpv2_15k/images/val
  annotations/
    train/  # generated by prepare_mhpv2_lt_7k_sem_seg.py
    val/    # linked from mhpv2_15k/annotations/val
```